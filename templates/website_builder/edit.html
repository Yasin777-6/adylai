{% extends 'base.html' %}
{% load i18n %}

{% block title %}Edit Website - {{ request.user.lawyer_profile.full_name }}{% endblock %}

{% block content %}
<div class="container-fluid h-100">
    <div class="row h-100">
        <!-- Content Editor -->
        <div class="col-lg-6 bg-white border-end">
            <div class="p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">
                        <i class="fas fa-edit me-2"></i>Edit Website Content
                    </h4>
                    <div class="btn-group">
                        <button type="button" class="btn btn-outline-secondary" onclick="saveChanges()">
                            <i class="fas fa-save me-1"></i>Save
                        </button>
                        <a href="{% url 'website_builder:preview' %}" class="btn btn-primary" target="_blank">
                            <i class="fas fa-eye me-1"></i>Preview
                        </a>
                    </div>
                </div>
                
                <!-- Page Selector -->
                <div class="mb-4">
                    <label class="form-label">Edit Page:</label>
                    <select class="form-select" id="pageSelector" onchange="loadPageContent()">
                        <option value="home">Home Page</option>
                        <option value="about">About Us</option>
                        <option value="services">Services</option>
                        <option value="contact">Contact</option>
                        <option value="blog">Blog</option>
                    </select>
                </div>
                
                <!-- Content Sections -->
                <div id="contentEditor">
                    <!-- Hero Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-star me-2"></i>Hero Section
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Main Headline</label>
                                <input type="text" class="form-control" id="heroTitle" 
                                       value="Professional Legal Services in Kyrgyzstan" 
                                       onchange="updatePreview()">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Subtitle</label>
                                <textarea class="form-control" rows="2" id="heroSubtitle" onchange="updatePreview()">Experienced lawyer providing comprehensive legal solutions for individuals and businesses.</textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Call-to-Action Button Text</label>
                                <input type="text" class="form-control" id="heroCTA" 
                                       value="Schedule Consultation" 
                                       onchange="updatePreview()">
                            </div>
                        </div>
                    </div>
                    
                    <!-- About Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-user me-2"></i>About Section
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Section Title</label>
                                <input type="text" class="form-control" id="aboutTitle" 
                                       value="About {{ request.user.lawyer_profile.full_name }}" 
                                       onchange="updatePreview()">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Biography</label>
                                <textarea class="form-control" rows="4" id="aboutText" onchange="updatePreview()">{{ request.user.lawyer_profile.bio|default:"Professional lawyer with extensive experience in various areas of law. Committed to providing high-quality legal services to clients throughout Kyrgyzstan." }}</textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Years of Experience</label>
                                <input type="number" class="form-control" id="yearsExperience" 
                                       value="{{ request.user.lawyer_profile.years_experience|default:5 }}" 
                                       onchange="updatePreview()">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Services Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-briefcase me-2"></i>Services Section
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Section Title</label>
                                <input type="text" class="form-control" id="servicesTitle" 
                                       value="Legal Services" 
                                       onchange="updatePreview()">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Services Description</label>
                                <textarea class="form-control" rows="3" id="servicesDescription" onchange="updatePreview()">We provide comprehensive legal services to meet all your legal needs.</textarea>
                            </div>
                            
                            <!-- Services List -->
                            <div id="servicesList">
                                <label class="form-label">Services Offered:</label>
                                <div class="row g-3">
                                    {% for specialty in request.user.lawyer_profile.specialties %}
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" checked onchange="updatePreview()">
                                            <label class="form-check-label">{{ specialty }}</label>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" checked onchange="updatePreview()">
                                            <label class="form-check-label">Civil Law</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" checked onchange="updatePreview()">
                                            <label class="form-check-label">Business Law</label>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-phone me-2"></i>Contact Information
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Phone Number</label>
                                    <input type="text" class="form-control" id="contactPhone" 
                                           value="{{ request.user.lawyer_profile.phone }}" 
                                           onchange="updatePreview()">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Email Address</label>
                                    <input type="email" class="form-control" id="contactEmail" 
                                           value="{{ request.user.email }}" 
                                           onchange="updatePreview()">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Office Address</label>
                                    <textarea class="form-control" rows="2" id="contactAddress" onchange="updatePreview()">{{ request.user.lawyer_profile.firm.address|default:"Bishkek, Kyrgyzstan" }}</textarea>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Consultation Fee</label>
                                    <input type="number" class="form-control" id="consultationFee" 
                                           value="{{ request.user.lawyer_profile.consultation_fee }}" 
                                           onchange="updatePreview()">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Colors & Theme -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-palette me-2"></i>Theme & Colors
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Primary Color</label>
                                    <input type="color" class="form-control form-control-color" 
                                           value="#1e3a8a" onchange="updatePreview()">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Secondary Color</label>
                                    <input type="color" class="form-control form-control-color" 
                                           value="#3b82f6" onchange="updatePreview()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Save Button -->
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-primary btn-lg" onclick="saveChanges()">
                        <i class="fas fa-save me-2"></i>Save All Changes
                    </button>
                    <a href="{% url 'website_builder:dashboard' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Live Preview -->
        <div class="col-lg-6 bg-light">
            <div class="p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="mb-0">
                        <i class="fas fa-eye me-2"></i>Live Preview
                    </h5>
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-outline-secondary active" onclick="setPreviewMode('desktop')">
                            <i class="fas fa-desktop"></i>
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPreviewMode('tablet')">
                            <i class="fas fa-tablet-alt"></i>
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPreviewMode('mobile')">
                            <i class="fas fa-mobile-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div id="previewContainer" class="border rounded">
                    <iframe id="previewFrame" src="{% url 'website_builder:preview' %}" 
                            class="w-100 border-0" style="height: 800px;" title="Website Preview"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updatePreview() {
    // Update the preview iframe with current content
    const iframe = document.getElementById('previewFrame');
    iframe.contentWindow.location.reload();
}

function saveChanges() {
    // Collect all form data
    const data = {
        heroTitle: document.getElementById('heroTitle').value,
        heroSubtitle: document.getElementById('heroSubtitle').value,
        heroCTA: document.getElementById('heroCTA').value,
        aboutTitle: document.getElementById('aboutTitle').value,
        aboutText: document.getElementById('aboutText').value,
        yearsExperience: document.getElementById('yearsExperience').value,
        servicesTitle: document.getElementById('servicesTitle').value,
        servicesDescription: document.getElementById('servicesDescription').value,
        contactPhone: document.getElementById('contactPhone').value,
        contactEmail: document.getElementById('contactEmail').value,
        contactAddress: document.getElementById('contactAddress').value,
        consultationFee: document.getElementById('consultationFee').value,
    };
    
    // Send AJAX request to save
    fetch('{% url "website_builder:dashboard" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Changes saved successfully!');
            updatePreview();
        } else {
            alert('Error saving changes: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving changes');
    });
}

function loadPageContent() {
    const page = document.getElementById('pageSelector').value;
    // Load content for selected page
    updatePreview();
}

function setPreviewMode(mode) {
    const iframe = document.getElementById('previewFrame');
    const container = document.getElementById('previewContainer');
    
    // Remove active class from all buttons
    document.querySelectorAll('.btn-group button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Add active class to clicked button
    event.target.classList.add('active');
    
    // Set preview size based on mode
    switch(mode) {
        case 'desktop':
            iframe.style.width = '100%';
            iframe.style.height = '800px';
            break;
        case 'tablet':
            iframe.style.width = '768px';
            iframe.style.height = '600px';
            container.style.overflow = 'auto';
            break;
        case 'mobile':
            iframe.style.width = '375px';
            iframe.style.height = '600px';
            container.style.overflow = 'auto';
            break;
    }
}
</script>
{% endblock %} 